var To=Object.defineProperty;var $o=(e,t,n)=>t in e?To(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $=(e,t,n)=>($o(e,typeof t!="symbol"?t+"":t,n),n);import{s as or,n as jt,r as sr,b as Io,x as Kt,y as Lo,z as Cn,o as ko}from"../chunks/scheduler.BCKgfOkU.js";import{S as ir,i as ar,e as ee,s as Oe,c as te,d as nt,g as V,h as Ne,y as ut,o as G,j as Y,k as Se,z as Ke,A as Uo,m as On,B as ft,b as Ro,f as Co,l as Oo,u as No,v as Ho,w as Po,t as Mo,a as qo,x as Do}from"../chunks/index.DsQzpBPX.js";import{w as sn}from"../chunks/index.9hEh0E69.js";function Nn(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Hn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function cr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function zo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hn(e.outputLen),Hn(e.blockLen)}function dt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Vo(e,t){cr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Rt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const lr=e=>e instanceof Uint8Array,Ct=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),se=(e,t)=>e<<32-t|e>>>t,jo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!jo)throw new Error("Non little-endian hardware is not supported");function Ko(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function an(e){if(typeof e=="string"&&(e=Ko(e)),!lr(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Wo(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!lr(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let ur=class{clone(){return this._cloneInto()}};function Zo(e){const t=r=>e().update(an(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function fr(e=32){if(Rt&&typeof Rt.getRandomValues=="function")return Rt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Fo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,i,r),e.setUint32(t+l,a,r)}let Go=class extends ur{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ct(this.buffer)}update(t){dt(this);const{view:n,buffer:r,blockLen:o}=this;t=an(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Ct(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){dt(this),Vo(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;Fo(r,o-8,BigInt(this.length*8),s),this.process(r,0);const a=Ct(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};const Jo=(e,t,n)=>e&t^~e&n,Yo=(e,t,n)=>e&t^e&n^t&n,Xo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),me=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xe=new Uint32Array(64);let Qo=class extends Go{constructor(){super(64,32,8,!1),this.A=me[0]|0,this.B=me[1]|0,this.C=me[2]|0,this.D=me[3]|0,this.E=me[4]|0,this.F=me[5]|0,this.G=me[6]|0,this.H=me[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[t,n,r,o,s,i,a,c]}set(t,n,r,o,s,i,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,n){for(let u=0;u<16;u++,n+=4)xe[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const d=xe[u-15],y=xe[u-2],b=se(d,7)^se(d,18)^d>>>3,h=se(y,17)^se(y,19)^y>>>10;xe[u]=h+xe[u-7]+b+xe[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){const d=se(a,6)^se(a,11)^se(a,25),y=f+d+Jo(a,c,l)+Xo[u]+xe[u]|0,h=(se(r,2)^se(r,13)^se(r,22))+Yo(r,o,s)|0;f=l,l=c,c=a,a=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){xe.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Wt=Zo(()=>new Qo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dr=BigInt(0),bt=BigInt(1),es=BigInt(2),vt=e=>e instanceof Uint8Array,ts=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function We(e){if(!vt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=ts[e[n]];return t}function hr(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function cn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ze(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function J(e){return cn(We(e))}function ln(e){if(!vt(e))throw new Error("Uint8Array expected");return cn(We(Uint8Array.from(e).reverse()))}function $e(e,t){return Ze(e.toString(16).padStart(t*2,"0"))}function un(e,t){return $e(e,t).reverse()}function ns(e){return Ze(hr(e))}function Z(e,t,n){let r;if(typeof t=="string")try{r=Ze(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(vt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function He(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!vt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function rs(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function os(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ss(e){let t;for(t=0;e>dr;e>>=bt,t+=1);return t}function is(e,t){return e>>BigInt(t)&bt}const as=(e,t,n)=>e|(n?bt:dr)<<BigInt(t),fn=e=>(es<<BigInt(e-1))-bt,Ot=e=>new Uint8Array(e),Pn=e=>Uint8Array.from(e);function pr(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Ot(e),o=Ot(e),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},a=(...u)=>n(o,r,...u),c=(u=Ot())=>{o=a(Pn([0]),u),r=a(),u.length!==0&&(o=a(Pn([1]),u),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<t;){r=a();const y=r.slice();d.push(y),u+=r.length}return He(...d)};return(u,d)=>{i(),c(u);let y;for(;!(y=d(l()));)c();return i(),y}}const cs={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function st(e,t,n={}){const r=(o,s,i)=>{const a=cs[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[o];if(!(i&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(t))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return e}const ls=Object.freeze(Object.defineProperty({__proto__:null,bitGet:is,bitLen:ss,bitMask:fn,bitSet:as,bytesToHex:We,bytesToNumberBE:J,bytesToNumberLE:ln,concatBytes:He,createHmacDrbg:pr,ensureBytes:Z,equalBytes:rs,hexToBytes:Ze,hexToNumber:cn,numberToBytesBE:$e,numberToBytesLE:un,numberToHexUnpadded:hr,numberToVarBytesBE:ns,utf8ToBytes:os,validateObject:st},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const K=BigInt(0),D=BigInt(1),Re=BigInt(2),us=BigInt(3),Zt=BigInt(4),Mn=BigInt(5),qn=BigInt(8);BigInt(9);BigInt(16);function W(e,t){const n=e%t;return n>=K?n:t+n}function fs(e,t,n){if(n<=K||t<K)throw new Error("Expected power/modulo > 0");if(n===D)return K;let r=D;for(;t>K;)t&D&&(r=r*e%n),e=e*e%n,t>>=D;return r}function X(e,t,n){let r=e;for(;t-- >K;)r*=r,r%=n;return r}function Ft(e,t){if(e===K||t<=K)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=W(e,t),r=t,o=K,s=D;for(;n!==K;){const a=r/n,c=r%n,l=o-s*a;r=n,n=c,o=s,s=l}if(r!==D)throw new Error("invert: does not exist");return W(o,t)}function ds(e){const t=(e-D)/Re;let n,r,o;for(n=e-D,r=0;n%Re===K;n/=Re,r++);for(o=Re;o<e&&fs(o,t,e)!==e-D;o++);if(r===1){const i=(e+D)/Zt;return function(c,l){const f=c.pow(l,i);if(!c.eql(c.sqr(f),l))throw new Error("Cannot find square root");return f}}const s=(n+D)/Re;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,f=a.pow(a.mul(a.ONE,o),n),u=a.pow(c,s),d=a.pow(c,n);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let y=1;for(let h=a.sqr(d);y<l&&!a.eql(h,a.ONE);y++)h=a.sqr(h);const b=a.pow(f,D<<BigInt(l-y-1));f=a.sqr(b),u=a.mul(u,b),d=a.mul(d,f),l=y}return u}}function hs(e){if(e%Zt===us){const t=(e+D)/Zt;return function(r,o){const s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%qn===Mn){const t=(e-Mn)/qn;return function(r,o){const s=r.mul(o,Re),i=r.pow(s,t),a=r.mul(o,i),c=r.mul(r.mul(a,Re),i),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),o))throw new Error("Cannot find square root");return l}}return ds(e)}const ps=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function gs(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ps.reduce((r,o)=>(r[o]="function",r),t);return st(e,n)}function ys(e,t,n){if(n<K)throw new Error("Expected power > 0");if(n===K)return e.ONE;if(n===D)return t;let r=e.ONE,o=t;for(;n>K;)n&D&&(r=e.mul(r,o)),o=e.sqr(o),n>>=D;return r}function ws(e,t){const n=new Array(t.length),r=t.reduce((s,i,a)=>e.is0(i)?s:(n[a]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,a)=>e.is0(i)?s:(n[a]=e.mul(s,n[a]),e.mul(s,i)),o),n}function gr(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function bs(e,t,n=!1,r={}){if(e<=K)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=gr(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=hs(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:fn(o),ZERO:K,ONE:D,create:c=>W(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return K<=c&&c<e},is0:c=>c===K,isOdd:c=>(c&D)===D,neg:c=>W(-c,e),eql:(c,l)=>c===l,sqr:c=>W(c*c,e),add:(c,l)=>W(c+l,e),sub:(c,l)=>W(c-l,e),mul:(c,l)=>W(c*l,e),pow:(c,l)=>ys(a,c,l),div:(c,l)=>W(c*Ft(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ft(c,e),sqrt:r.sqrt||(c=>i(a,c)),invertBatch:c=>ws(a,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>n?un(c,s):$e(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?ln(c):J(c)}});return Object.freeze(a)}function yr(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function wr(e){const t=yr(e);return t+Math.ceil(t/2)}function vs(e,t,n=!1){const r=e.length,o=yr(t),s=wr(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=n?J(e):ln(e),a=W(i,t-D)+D;return n?un(a,o):$e(a,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Es=BigInt(0),Nt=BigInt(1);function ms(e,t){const n=(o,s)=>{const i=s.negate();return o?i:s},r=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,a=o;for(;s>Es;)s&Nt&&(i=i.add(a)),a=a.double(),s>>=Nt;return i},precomputeWindow(o,s){const{windows:i,windowSize:a}=r(s),c=[];let l=o,f=l;for(let u=0;u<i;u++){f=l,c.push(f);for(let d=1;d<a;d++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,i){const{windows:a,windowSize:c}=r(o);let l=e.ZERO,f=e.BASE;const u=BigInt(2**o-1),d=2**o,y=BigInt(o);for(let b=0;b<a;b++){const h=b*c;let p=Number(i&u);i>>=y,p>c&&(p-=d,i+=Nt);const g=h,w=h+Math.abs(p)-1,x=b%2!==0,A=p<0;p===0?f=f.add(n(x,s[g])):l=l.add(n(A,s[w]))}return{p:l,f}},wNAFCached(o,s,i,a){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,a(l))),this.wNAF(c,l,i)}}}function br(e){return gs(e.Fp),st(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xs(e){const t=br(e);st(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:As,hexToBytes:_s}=ls,Ce={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Ce;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:As(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Ce,n=typeof e=="string"?_s(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=Ce._parseInt(n.subarray(2)),{d:i,l:a}=Ce._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},r=t(n(e.s)),o=t(n(e.r)),s=r.length/2,i=o.length/2,a=n(s),c=n(i);return`30${n(i+s+4)}02${c}${o}02${a}${r}`}},de=BigInt(0),Q=BigInt(1);BigInt(2);const Dn=BigInt(3);BigInt(4);function Ss(e){const t=xs(e),{Fp:n}=t,r=t.toBytes||((b,h,p)=>{const g=h.toAffine();return He(Uint8Array.from([4]),n.toBytes(g.x),n.toBytes(g.y))}),o=t.fromBytes||(b=>{const h=b.subarray(1),p=n.fromBytes(h.subarray(0,n.BYTES)),g=n.fromBytes(h.subarray(n.BYTES,2*n.BYTES));return{x:p,y:g}});function s(b){const{a:h,b:p}=t,g=n.sqr(b),w=n.mul(g,b);return n.add(n.add(w,n.mul(b,h)),p)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(b){return typeof b=="bigint"&&de<b&&b<t.n}function a(b){if(!i(b))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(b){const{allowedPrivateKeyLengths:h,nByteLength:p,wrapPrivateKey:g,n:w}=t;if(h&&typeof b!="bigint"){if(b instanceof Uint8Array&&(b=We(b)),typeof b!="string"||!h.includes(b.length))throw new Error("Invalid key");b=b.padStart(p*2,"0")}let x;try{x=typeof b=="bigint"?b:J(Z("private key",b,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof b}`)}return g&&(x=W(x,w)),a(x),x}const l=new Map;function f(b){if(!(b instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(h,p,g){if(this.px=h,this.py=p,this.pz=g,h==null||!n.isValid(h))throw new Error("x required");if(p==null||!n.isValid(p))throw new Error("y required");if(g==null||!n.isValid(g))throw new Error("z required")}static fromAffine(h){const{x:p,y:g}=h||{};if(!h||!n.isValid(p)||!n.isValid(g))throw new Error("invalid affine point");if(h instanceof u)throw new Error("projective point not allowed");const w=x=>n.eql(x,n.ZERO);return w(p)&&w(g)?u.ZERO:new u(p,g,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){const p=n.invertBatch(h.map(g=>g.pz));return h.map((g,w)=>g.toAffine(p[w])).map(u.fromAffine)}static fromHex(h){const p=u.fromAffine(o(Z("pointHex",h)));return p.assertValidity(),p}static fromPrivateKey(h){return u.BASE.multiply(c(h))}_setWindowSize(h){this._WINDOW_SIZE=h,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:h,y:p}=this.toAffine();if(!n.isValid(h)||!n.isValid(p))throw new Error("bad point: x or y not FE");const g=n.sqr(p),w=s(h);if(!n.eql(g,w))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:h}=this.toAffine();if(n.isOdd)return!n.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);const{px:p,py:g,pz:w}=this,{px:x,py:A,pz:T}=h,m=n.eql(n.mul(p,T),n.mul(x,w)),_=n.eql(n.mul(g,T),n.mul(A,w));return m&&_}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:h,b:p}=t,g=n.mul(p,Dn),{px:w,py:x,pz:A}=this;let T=n.ZERO,m=n.ZERO,_=n.ZERO,S=n.mul(w,w),M=n.mul(x,x),U=n.mul(A,A),I=n.mul(w,x);return I=n.add(I,I),_=n.mul(w,A),_=n.add(_,_),T=n.mul(h,_),m=n.mul(g,U),m=n.add(T,m),T=n.sub(M,m),m=n.add(M,m),m=n.mul(T,m),T=n.mul(I,T),_=n.mul(g,_),U=n.mul(h,U),I=n.sub(S,U),I=n.mul(h,I),I=n.add(I,_),_=n.add(S,S),S=n.add(_,S),S=n.add(S,U),S=n.mul(S,I),m=n.add(m,S),U=n.mul(x,A),U=n.add(U,U),S=n.mul(U,I),T=n.sub(T,S),_=n.mul(U,M),_=n.add(_,_),_=n.add(_,_),new u(T,m,_)}add(h){f(h);const{px:p,py:g,pz:w}=this,{px:x,py:A,pz:T}=h;let m=n.ZERO,_=n.ZERO,S=n.ZERO;const M=t.a,U=n.mul(t.b,Dn);let I=n.mul(p,x),N=n.mul(g,A),H=n.mul(w,T),q=n.add(p,g),v=n.add(x,A);q=n.mul(q,v),v=n.add(I,N),q=n.sub(q,v),v=n.add(p,w);let E=n.add(x,T);return v=n.mul(v,E),E=n.add(I,H),v=n.sub(v,E),E=n.add(g,w),m=n.add(A,T),E=n.mul(E,m),m=n.add(N,H),E=n.sub(E,m),S=n.mul(M,v),m=n.mul(U,H),S=n.add(m,S),m=n.sub(N,S),S=n.add(N,S),_=n.mul(m,S),N=n.add(I,I),N=n.add(N,I),H=n.mul(M,H),v=n.mul(U,v),N=n.add(N,H),H=n.sub(I,H),H=n.mul(M,H),v=n.add(v,H),I=n.mul(N,v),_=n.add(_,I),I=n.mul(E,v),m=n.mul(q,m),m=n.sub(m,I),I=n.mul(q,N),S=n.mul(E,S),S=n.add(S,I),new u(m,_,S)}subtract(h){return this.add(h.negate())}is0(){return this.equals(u.ZERO)}wNAF(h){return y.wNAFCached(this,l,h,p=>{const g=n.invertBatch(p.map(w=>w.pz));return p.map((w,x)=>w.toAffine(g[x])).map(u.fromAffine)})}multiplyUnsafe(h){const p=u.ZERO;if(h===de)return p;if(a(h),h===Q)return this;const{endo:g}=t;if(!g)return y.unsafeLadder(this,h);let{k1neg:w,k1:x,k2neg:A,k2:T}=g.splitScalar(h),m=p,_=p,S=this;for(;x>de||T>de;)x&Q&&(m=m.add(S)),T&Q&&(_=_.add(S)),S=S.double(),x>>=Q,T>>=Q;return w&&(m=m.negate()),A&&(_=_.negate()),_=new u(n.mul(_.px,g.beta),_.py,_.pz),m.add(_)}multiply(h){a(h);let p=h,g,w;const{endo:x}=t;if(x){const{k1neg:A,k1:T,k2neg:m,k2:_}=x.splitScalar(p);let{p:S,f:M}=this.wNAF(T),{p:U,f:I}=this.wNAF(_);S=y.constTimeNegate(A,S),U=y.constTimeNegate(m,U),U=new u(n.mul(U.px,x.beta),U.py,U.pz),g=S.add(U),w=M.add(I)}else{const{p:A,f:T}=this.wNAF(p);g=A,w=T}return u.normalizeZ([g,w])[0]}multiplyAndAddUnsafe(h,p,g){const w=u.BASE,x=(T,m)=>m===de||m===Q||!T.equals(w)?T.multiplyUnsafe(m):T.multiply(m),A=x(this,p).add(x(h,g));return A.is0()?void 0:A}toAffine(h){const{px:p,py:g,pz:w}=this,x=this.is0();h==null&&(h=x?n.ONE:n.inv(w));const A=n.mul(p,h),T=n.mul(g,h),m=n.mul(w,h);if(x)return{x:n.ZERO,y:n.ZERO};if(!n.eql(m,n.ONE))throw new Error("invZ was invalid");return{x:A,y:T}}isTorsionFree(){const{h,isTorsionFree:p}=t;if(h===Q)return!0;if(p)return p(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h,clearCofactor:p}=t;return h===Q?this:p?p(u,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return this.assertValidity(),r(u,this,h)}toHex(h=!0){return We(this.toRawBytes(h))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,y=ms(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}function Bs(e){const t=br(e);return st(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Ts(e){const t=Bs(e),{Fp:n,n:r}=t,o=n.BYTES+1,s=2*n.BYTES+1;function i(v){return de<v&&v<n.ORDER}function a(v){return W(v,r)}function c(v){return Ft(v,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:d}=Ss({...t,toBytes(v,E,B){const k=E.toAffine(),L=n.toBytes(k.x),R=He;return B?R(Uint8Array.from([E.hasEvenY()?2:3]),L):R(Uint8Array.from([4]),L,n.toBytes(k.y))},fromBytes(v){const E=v.length,B=v[0],k=v.subarray(1);if(E===o&&(B===2||B===3)){const L=J(k);if(!i(L))throw new Error("Point is not on curve");const R=u(L);let P=n.sqrt(R);const O=(P&Q)===Q;return(B&1)===1!==O&&(P=n.neg(P)),{x:L,y:P}}else if(E===s&&B===4){const L=n.fromBytes(k.subarray(0,n.BYTES)),R=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:L,y:R}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),y=v=>We($e(v,t.nByteLength));function b(v){const E=r>>Q;return v>E}function h(v){return b(v)?a(-v):v}const p=(v,E,B)=>J(v.slice(E,B));class g{constructor(E,B,k){this.r=E,this.s=B,this.recovery=k,this.assertValidity()}static fromCompact(E){const B=t.nByteLength;return E=Z("compactSignature",E,B*2),new g(p(E,0,B),p(E,B,2*B))}static fromDER(E){const{r:B,s:k}=Ce.toSig(Z("DER",E));return new g(B,k)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new g(this.r,this.s,E)}recoverPublicKey(E){const{r:B,s:k,recovery:L}=this,R=_(Z("msgHash",E));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");const P=L===2||L===3?B+t.n:B;if(P>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const O=L&1?"03":"02",ne=l.fromHex(O+y(P)),ve=c(P),Pe=a(-R*ve),Xe=a(k*ve),Ee=l.BASE.multiplyAndAddUnsafe(ne,Pe,Xe);if(!Ee)throw new Error("point at infinify");return Ee.assertValidity(),Ee}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Ze(this.toDERHex())}toDERHex(){return Ce.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ze(this.toCompactHex())}toCompactHex(){return y(this.r)+y(this.s)}}const w={isValidPrivateKey(v){try{return f(v),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const v=wr(t.n);return vs(t.randomBytes(v),t.n)},precompute(v=8,E=l.BASE){return E._setWindowSize(v),E.multiply(BigInt(3)),E}};function x(v,E=!0){return l.fromPrivateKey(v).toRawBytes(E)}function A(v){const E=v instanceof Uint8Array,B=typeof v=="string",k=(E||B)&&v.length;return E?k===o||k===s:B?k===2*o||k===2*s:v instanceof l}function T(v,E,B=!0){if(A(v))throw new Error("first arg must be private key");if(!A(E))throw new Error("second arg must be public key");return l.fromHex(E).multiply(f(v)).toRawBytes(B)}const m=t.bits2int||function(v){const E=J(v),B=v.length*8-t.nBitLength;return B>0?E>>BigInt(B):E},_=t.bits2int_modN||function(v){return a(m(v))},S=fn(t.nBitLength);function M(v){if(typeof v!="bigint")throw new Error("bigint expected");if(!(de<=v&&v<S))throw new Error(`bigint expected < 2^${t.nBitLength}`);return $e(v,t.nByteLength)}function U(v,E,B=I){if(["recovered","canonical"].some(ke=>ke in B))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:L}=t;let{lowS:R,prehash:P,extraEntropy:O}=B;R==null&&(R=!0),v=Z("msgHash",v),P&&(v=Z("prehashed msgHash",k(v)));const ne=_(v),ve=f(E),Pe=[M(ve),M(ne)];if(O!=null){const ke=O===!0?L(n.BYTES):O;Pe.push(Z("extraEntropy",ke))}const Xe=He(...Pe),Ee=ne;function Ut(ke){const Me=m(ke);if(!d(Me))return;const kn=c(Me),qe=l.BASE.multiply(Me).toAffine(),re=a(qe.x);if(re===de)return;const De=a(kn*a(Ee+re*ve));if(De===de)return;let Un=(qe.x===re?0:2)|Number(qe.y&Q),Rn=De;return R&&b(De)&&(Rn=h(De),Un^=1),new g(re,Rn,Un)}return{seed:Xe,k2sig:Ut}}const I={lowS:t.lowS,prehash:!1},N={lowS:t.lowS,prehash:!1};function H(v,E,B=I){const{seed:k,k2sig:L}=U(v,E,B),R=t;return pr(R.hash.outputLen,R.nByteLength,R.hmac)(k,L)}l.BASE._setWindowSize(8);function q(v,E,B,k=N){var qe;const L=v;if(E=Z("msgHash",E),B=Z("publicKey",B),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:R,prehash:P}=k;let O,ne;try{if(typeof L=="string"||L instanceof Uint8Array)try{O=g.fromDER(L)}catch(re){if(!(re instanceof Ce.Err))throw re;O=g.fromCompact(L)}else if(typeof L=="object"&&typeof L.r=="bigint"&&typeof L.s=="bigint"){const{r:re,s:De}=L;O=new g(re,De)}else throw new Error("PARSE");ne=l.fromHex(B)}catch(re){if(re.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(R&&O.hasHighS())return!1;P&&(E=t.hash(E));const{r:ve,s:Pe}=O,Xe=_(E),Ee=c(Pe),Ut=a(Xe*Ee),ke=a(ve*Ee),Me=(qe=l.BASE.multiplyAndAddUnsafe(ne,Ut,ke))==null?void 0:qe.toAffine();return Me?a(Me.x)===ve:!1}return{CURVE:t,getPublicKey:x,getSharedSecret:T,sign:H,verify:q,ProjectivePoint:l,Signature:g,utils:w}}let vr=class extends ur{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,zo(t);const r=an(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return dt(this),this.iHash.update(t),this}digestInto(t){dt(this),cr(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Er=(e,t,n)=>new vr(e,t).update(n).digest();Er.create=(e,t)=>new vr(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $s(e){return{hash:e,hmac:(t,...n)=>Er(e,t,Wo(...n)),randomBytes:fr}}function Is(e,t){const n=r=>Ts({...e,...$s(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Et=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ht=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),mr=BigInt(1),pt=BigInt(2),zn=(e,t)=>(e+t/pt)/t;function xr(e){const t=Et,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,f=l*l*e%t,u=X(f,n,t)*f%t,d=X(u,n,t)*f%t,y=X(d,pt,t)*l%t,b=X(y,o,t)*y%t,h=X(b,s,t)*b%t,p=X(h,a,t)*h%t,g=X(p,c,t)*p%t,w=X(g,a,t)*h%t,x=X(w,n,t)*f%t,A=X(x,i,t)*b%t,T=X(A,r,t)*l%t,m=X(T,pt,t);if(!Gt.eql(Gt.sqr(m),e))throw new Error("Cannot find square root");return m}const Gt=bs(Et,void 0,void 0,{sqrt:xr}),Je=Is({a:BigInt(0),b:BigInt(7),Fp:Gt,n:ht,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=ht,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-mr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),a=zn(s*e,t),c=zn(-r*e,t);let l=W(e-a*n-c*o,t),f=W(-a*r-c*s,t);const u=l>i,d=f>i;if(u&&(l=t-l),d&&(f=t-f),l>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:d,k2:f}}}},Wt),mt=BigInt(0),Ar=e=>typeof e=="bigint"&&mt<e&&e<Et,Ls=e=>typeof e=="bigint"&&mt<e&&e<ht,Vn={};function gt(e,...t){let n=Vn[e];if(n===void 0){const r=Wt(Uint8Array.from(e,o=>o.charCodeAt(0)));n=He(r,r),Vn[e]=n}return Wt(He(n,...t))}const dn=e=>e.toRawBytes(!0).slice(1),Jt=e=>$e(e,32),Ht=e=>W(e,Et),rt=e=>W(e,ht),hn=Je.ProjectivePoint,ks=(e,t,n)=>hn.BASE.multiplyAndAddUnsafe(e,t,n);function Yt(e){let t=Je.utils.normPrivateKeyToScalar(e),n=hn.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:rt(-t),bytes:dn(n)}}function _r(e){if(!Ar(e))throw new Error("bad x: need 0 < x < p");const t=Ht(e*e),n=Ht(t*e+BigInt(7));let r=xr(n);r%pt!==mt&&(r=Ht(-r));const o=new hn(e,r,mr);return o.assertValidity(),o}function Sr(...e){return rt(J(gt("BIP0340/challenge",...e)))}function Us(e){return Yt(e).bytes}function Rs(e,t,n=fr(32)){const r=Z("message",e),{bytes:o,scalar:s}=Yt(t),i=Z("auxRand",n,32),a=Jt(s^J(gt("BIP0340/aux",i))),c=gt("BIP0340/nonce",a,o,r),l=rt(J(c));if(l===mt)throw new Error("sign failed: k is zero");const{bytes:f,scalar:u}=Yt(l),d=Sr(f,o,r),y=new Uint8Array(64);if(y.set(f,0),y.set(Jt(rt(u+d*s)),32),!Br(y,r,o))throw new Error("sign: Invalid signature produced");return y}function Br(e,t,n){const r=Z("signature",e,64),o=Z("message",t),s=Z("publicKey",n,32);try{const i=_r(J(s)),a=J(r.subarray(0,32));if(!Ar(a))return!1;const c=J(r.subarray(32,64));if(!Ls(c))return!1;const l=Sr(Jt(a),dn(i),o),f=ks(i,c,rt(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==a)}catch{return!1}}const ce={getPublicKey:Us,sign:Rs,verify:Br,utils:{randomPrivateKey:Je.utils.randomPrivateKey,lift_x:_r,pointToBytes:dn,numberToBytesBE:$e,bytesToNumberBE:J,taggedHash:gt,mod:W}},Pt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pn=e=>e instanceof Uint8Array,Mt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ie=(e,t)=>e<<32-t|e>>>t,Cs=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Cs)throw new Error("Non little-endian hardware is not supported");const Os=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function j(e){if(!pn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Os[e[n]];return t}function Fe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Tr(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ot(e){if(typeof e=="string"&&(e=Tr(e)),!pn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function yt(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!pn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class $r{clone(){return this._cloneInto()}}function Ir(e){const t=r=>e().update(ot(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Lr(e=32){if(Pt&&typeof Pt.getRandomValues=="function")return Pt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Xt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ns(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function kr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Hs(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Xt(e.outputLen),Xt(e.blockLen)}function Ps(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ms(e,t){kr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const le={number:Xt,bool:Ns,bytes:kr,hash:Hs,exists:Ps,output:Ms};function qs(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,i,r),e.setUint32(t+l,a,r)}class Ds extends $r{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Mt(this.buffer)}update(t){le.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=ot(t);const s=t.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Mt(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){le.exists(this),le.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;qs(r,o-8,BigInt(this.length*8),s),this.process(r,0);const a=Mt(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}}const zs=(e,t,n)=>e&t^~e&n,Vs=(e,t,n)=>e&t^e&n^t&n,js=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ae=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_e=new Uint32Array(64);class Ur extends Ds{constructor(){super(64,32,8,!1),this.A=Ae[0]|0,this.B=Ae[1]|0,this.C=Ae[2]|0,this.D=Ae[3]|0,this.E=Ae[4]|0,this.F=Ae[5]|0,this.G=Ae[6]|0,this.H=Ae[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[t,n,r,o,s,i,a,c]}set(t,n,r,o,s,i,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,n){for(let u=0;u<16;u++,n+=4)_e[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const d=_e[u-15],y=_e[u-2],b=ie(d,7)^ie(d,18)^d>>>3,h=ie(y,17)^ie(y,19)^y>>>10;_e[u]=h+_e[u-7]+b+_e[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){const d=ie(a,6)^ie(a,11)^ie(a,25),y=f+d+zs(a,c,l)+js[u]+_e[u]|0,h=(ie(r,2)^ie(r,13)^ie(r,22))+Vs(r,o,s)|0;f=l,l=c,c=a,a=i+y|0,i=s,s=o,o=r,r=y+h|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){_e.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Ks extends Ur{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const je=Ir(()=>new Ur);Ir(()=>new Ks);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ye(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function ye(...e){const t=(o,s)=>i=>o(s(i)),n=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),r=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function we(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ye(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function be(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function xt(e,t="="){if(Ye(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Rr(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function jn(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(Ye(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],f=t*i+l;if(!Number.isSafeInteger(f)||t*i/t!==i||f-l!==t*i)throw new Error("convertRadix: carry overflow");if(i=f%n,s[c]=Math.floor(f/n),!Number.isSafeInteger(s[c])||s[c]*n+i!==f)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(o.push(i),a)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const Cr=(e,t)=>t?Cr(t,e%t):e,wt=(e,t)=>e+(t-Cr(e,t));function Qt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(wt(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${wt(t,n)}`);let o=0,s=0;const i=2**n-1,a=[];for(const c of e){if(Ye(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(o=o<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&a.push(o>>>0),a}function Ws(e){return Ye(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return jn(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(jn(t,e,2**8))}}}function Ie(e,t=!1){if(Ye(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(wt(8,e)>32||wt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Qt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Qt(n,e,8,t))}}}function Kn(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const Zs=ye(Ie(4),we("0123456789ABCDEF"),be("")),Fs=ye(Ie(5),we("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),xt(5),be(""));ye(Ie(5),we("0123456789ABCDEFGHIJKLMNOPQRSTUV"),xt(5),be(""));ye(Ie(5),we("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),be(""),Rr(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const ge=ye(Ie(6),we("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),xt(6),be("")),Gs=ye(Ie(6),we("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),xt(6),be("")),gn=e=>ye(Ws(58),we(e),be("")),en=gn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");gn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");gn("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Wn=[0,2,3,5,6,7,9,10,11],Js={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=en.encode(r).padStart(Wn[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Wn.indexOf(r.length),s=en.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},tn=ye(we("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),be("")),Zn=[996825010,642813549,513874426,1027748829,705979059];function Qe(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Zn.length;r++)(t>>r&1)===1&&(n^=Zn[r]);return n}function Fn(e,t,n=1){const r=e.length;let o=1;for(let s=0;s<r;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=Qe(o)^i>>5}o=Qe(o);for(let s=0;s<r;s++)o=Qe(o)^e.charCodeAt(s)&31;for(let s of t)o=Qe(o)^s;for(let s=0;s<6;s++)o=Qe(o);return o^=n,tn.encode(Qt([o%2**30],30,5,!1))}function Or(e){const t=e==="bech32"?1:734539939,n=Ie(5),r=n.decode,o=n.encode,s=Kn(r);function i(f,u,d=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);const y=f.length+7+u.length;if(d!==!1&&y>d)throw new TypeError(`Length ${y} exceeds limit ${d}`);return f=f.toLowerCase(),`${f}1${tn.encode(u)}${Fn(f,u,t)}`}function a(f,u=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||u!==!1&&f.length>u)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${u})`);const d=f.toLowerCase();if(f!==d&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=d;const y=f.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');const b=f.slice(0,y),h=f.slice(y+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const p=tn.decode(h).slice(0,-6),g=Fn(b,p,t);if(!h.endsWith(g))throw new Error(`Invalid checksum in ${f}: expected "${g}"`);return{prefix:b,words:p}}const c=Kn(a);function l(f){const{prefix:u,words:d}=a(f,!1);return{prefix:u,words:d,bytes:r(d)}}return{encode:i,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:o}}const Ge=Or("bech32");Or("bech32m");const Ys={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Xs=ye(Ie(4),we("0123456789abcdef"),be(""),Rr(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Qs={utf8:Ys,hex:Xs,base16:Zs,base32:Fs,base64:ge,base64url:Gs,base58:en,base58xmr:Js};`${Object.keys(Qs).join(", ")}`;function qt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Gn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function ei(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function pe(e,...t){if(!ei(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const F=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),ti=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ti)throw new Error("Non little-endian hardware is not supported");function Nr(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ni(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function ri(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const oi=(e,t)=>(Object.assign(t,e),t),Te=16,si=283;function yn(e){return e<<1^si&-(e>>7)}function Ve(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=yn(e);return n}const nn=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=yn(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),ii=nn.map((e,t)=>nn.indexOf(t)),ai=e=>e<<24|e>>>8,Dt=e=>e<<8|e>>>24;function Hr(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((l,f)=>t(e[f])),r=n.map(Dt),o=r.map(Dt),s=o.map(Dt),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const u=l*256+f;i[u]=n[l]^r[f],a[u]=o[l]^s[f],c[u]=e[l]<<8|e[f]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:o,T3:s,T01:i,T23:a}}const wn=Hr(nn,e=>Ve(e,3)<<24|e<<16|e<<8|Ve(e,2)),Pr=Hr(ii,e=>Ve(e,11)<<24|Ve(e,13)<<16|Ve(e,9)<<8|Ve(e,14)),ci=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=yn(n))e[t]=n;return e})();function Mr(e){pe(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=wn,r=F(e),o=r.length,s=a=>ue(n,a,a,a,a),i=new Uint32Array(t+28);i.set(r);for(let a=o;a<i.length;a++){let c=i[a-1];a%o===0?c=s(ai(c))^ci[a/o-1]:o>6&&a%o===4&&(c=s(c)),i[a]=i[a-o]^c}return i}function li(e){const t=Mr(e),n=t.slice(),r=t.length,{sbox2:o}=wn,{T0:s,T1:i,T2:a,T3:c}=Pr;for(let l=0;l<r;l+=4)for(let f=0;f<4;f++)n[l+f]=t[r-l-4+f];t.fill(0);for(let l=4;l<r-4;l++){const f=n[l],u=ue(o,f,f,f,f);n[l]=s[u&255]^i[u>>>8&255]^a[u>>>16&255]^c[u>>>24]}return n}function Be(e,t,n,r,o,s){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|s>>>24&255]}function ue(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function Jn(e,t,n,r,o){const{sbox2:s,T01:i,T23:a}=wn;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],o^=e[c++];const l=e.length/4-2;for(let b=0;b<l;b++){const h=e[c++]^Be(i,a,t,n,r,o),p=e[c++]^Be(i,a,n,r,o,t),g=e[c++]^Be(i,a,r,o,t,n),w=e[c++]^Be(i,a,o,t,n,r);t=h,n=p,r=g,o=w}const f=e[c++]^ue(s,t,n,r,o),u=e[c++]^ue(s,n,r,o,t),d=e[c++]^ue(s,r,o,t,n),y=e[c++]^ue(s,o,t,n,r);return{s0:f,s1:u,s2:d,s3:y}}function ui(e,t,n,r,o){const{sbox2:s,T01:i,T23:a}=Pr;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],o^=e[c++];const l=e.length/4-2;for(let b=0;b<l;b++){const h=e[c++]^Be(i,a,t,o,r,n),p=e[c++]^Be(i,a,n,t,o,r),g=e[c++]^Be(i,a,r,n,t,o),w=e[c++]^Be(i,a,o,r,n,t);t=h,n=p,r=g,o=w}const f=e[c++]^ue(s,t,o,r,n),u=e[c++]^ue(s,n,t,o,r),d=e[c++]^ue(s,r,n,t,o),y=e[c++]^ue(s,o,r,n,t);return{s0:f,s1:u,s2:d,s3:y}}function qr(e,t){if(!t)return new Uint8Array(e);if(pe(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function fi(e){if(pe(e),e.length%Te!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Te}`)}function di(e,t,n){let r=e.length;const o=r%Te;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=F(e);if(t){let c=Te-o;c||(c=Te),r=r+c}const i=qr(r,n),a=F(i);return{b:s,o:a,out:i}}function hi(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function pi(e){const t=new Uint8Array(16),n=F(t);t.set(e);const r=Te-e.length;for(let o=Te-r;o<Te;o++)t[o]=r;return n}const Dr=oi({blockSize:16,nonceLength:16},function(t,n,r={}){pe(t),pe(n,16);const o=!r.disablePadding;return{encrypt:(s,i)=>{const a=Mr(t),{b:c,o:l,out:f}=di(s,o,i),u=F(n);let d=u[0],y=u[1],b=u[2],h=u[3],p=0;for(;p+4<=c.length;)d^=c[p+0],y^=c[p+1],b^=c[p+2],h^=c[p+3],{s0:d,s1:y,s2:b,s3:h}=Jn(a,d,y,b,h),l[p++]=d,l[p++]=y,l[p++]=b,l[p++]=h;if(o){const g=pi(s.subarray(p*4));d^=g[0],y^=g[1],b^=g[2],h^=g[3],{s0:d,s1:y,s2:b,s3:h}=Jn(a,d,y,b,h),l[p++]=d,l[p++]=y,l[p++]=b,l[p++]=h}return a.fill(0),f},decrypt:(s,i)=>{fi(s);const a=li(t),c=F(n),l=qr(s.length,i),f=F(s),u=F(l);let d=c[0],y=c[1],b=c[2],h=c[3];for(let p=0;p+4<=f.length;){const g=d,w=y,x=b,A=h;d=f[p+0],y=f[p+1],b=f[p+2],h=f[p+3];const{s0:T,s1:m,s2:_,s3:S}=ui(a,d,y,b,h);u[p++]=T^g,u[p++]=m^w,u[p++]=_^x,u[p++]=S^A}return a.fill(0),hi(l,o)}}}),gi=Nr("expand 16-byte k"),yi=Nr("expand 32-byte k"),wi=F(gi),bi=F(yi);function C(e,t){return e<<t|e>>>32-t}function rn(e){return e.byteOffset%4===0}const at=64,vi=16,zr=2**32-1,Yn=new Uint32Array;function Ei(e,t,n,r,o,s,i,a){const c=o.length,l=new Uint8Array(at),f=F(l),u=rn(o)&&rn(s),d=u?F(o):Yn,y=u?F(s):Yn;for(let b=0;b<c;i++){if(e(t,n,r,f,i,a),i>=zr)throw new Error("arx: counter overflow");const h=Math.min(at,c-b);if(u&&h===at){const p=b/4;if(b%4!==0)throw new Error("arx: invalid block position");for(let g=0,w;g<vi;g++)w=p+g,y[w]=d[w]^f[g];b+=at;continue}for(let p=0,g;p<h;p++)g=b+p,s[g]=o[g]^l[p];b+=h}}function mi(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=ni({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return qt(o),qt(i),Gn(s),Gn(n),(a,c,l,f,u=0)=>{pe(a),pe(c),pe(l);const d=l.length;if(f||(f=new Uint8Array(d)),pe(f),qt(u),u<0||u>=zr)throw new Error("arx: counter overflow");if(f.length<d)throw new Error(`arx: output (${f.length}) is shorter than data (${d})`);const y=[];let b=a.length,h,p;if(b===32)h=a.slice(),y.push(h),p=bi;else if(b===16&&n)h=new Uint8Array(32),h.set(a),h.set(a,16),p=wi,y.push(h);else throw new Error(`arx: invalid 32-byte key, got length=${b}`);rn(c)||(c=c.slice(),y.push(c));const g=F(h);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,g,F(c.subarray(0,16)),g),c=c.subarray(16)}const w=16-o;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const A=new Uint8Array(12);A.set(c,s?0:12-c.length),c=A,y.push(c)}const x=F(c);for(Ei(e,p,g,x,l,f,u,i);y.length>0;)y.pop().fill(0);return f}}function xi(e,t,n,r,o,s=20){let i=e[0],a=e[1],c=e[2],l=e[3],f=t[0],u=t[1],d=t[2],y=t[3],b=t[4],h=t[5],p=t[6],g=t[7],w=o,x=n[0],A=n[1],T=n[2],m=i,_=a,S=c,M=l,U=f,I=u,N=d,H=y,q=b,v=h,E=p,B=g,k=w,L=x,R=A,P=T;for(let ne=0;ne<s;ne+=2)m=m+U|0,k=C(k^m,16),q=q+k|0,U=C(U^q,12),m=m+U|0,k=C(k^m,8),q=q+k|0,U=C(U^q,7),_=_+I|0,L=C(L^_,16),v=v+L|0,I=C(I^v,12),_=_+I|0,L=C(L^_,8),v=v+L|0,I=C(I^v,7),S=S+N|0,R=C(R^S,16),E=E+R|0,N=C(N^E,12),S=S+N|0,R=C(R^S,8),E=E+R|0,N=C(N^E,7),M=M+H|0,P=C(P^M,16),B=B+P|0,H=C(H^B,12),M=M+H|0,P=C(P^M,8),B=B+P|0,H=C(H^B,7),m=m+I|0,P=C(P^m,16),E=E+P|0,I=C(I^E,12),m=m+I|0,P=C(P^m,8),E=E+P|0,I=C(I^E,7),_=_+N|0,k=C(k^_,16),B=B+k|0,N=C(N^B,12),_=_+N|0,k=C(k^_,8),B=B+k|0,N=C(N^B,7),S=S+H|0,L=C(L^S,16),q=q+L|0,H=C(H^q,12),S=S+H|0,L=C(L^S,8),q=q+L|0,H=C(H^q,7),M=M+U|0,R=C(R^M,16),v=v+R|0,U=C(U^v,12),M=M+U|0,R=C(R^M,8),v=v+R|0,U=C(U^v,7);let O=0;r[O++]=i+m|0,r[O++]=a+_|0,r[O++]=c+S|0,r[O++]=l+M|0,r[O++]=f+U|0,r[O++]=u+I|0,r[O++]=d+N|0,r[O++]=y+H|0,r[O++]=b+q|0,r[O++]=h+v|0,r[O++]=p+E|0,r[O++]=g+B|0,r[O++]=w+k|0,r[O++]=x+L|0,r[O++]=A+R|0,r[O++]=T+P|0}const Xn=mi(xi,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Vr extends $r{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,le.hash(t);const r=ot(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return le.exists(this),this.iHash.update(t),this}digestInto(t){le.exists(this),le.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const At=(e,t,n)=>new Vr(e,t).update(n).digest();At.create=(e,t)=>new Vr(e,t);function Ai(e,t,n){return le.hash(e),At(e,ot(n),ot(t))}const zt=new Uint8Array([0]),Qn=new Uint8Array;function _i(e,t,n,r=32){if(le.hash(e),le.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Qn);const s=new Uint8Array(o*e.outputLen),i=At.create(e,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let l=0;l<o;l++)zt[0]=l+1,a.update(l===0?Qn:c).update(n).update(zt).digestInto(c),s.set(c,e.outputLen*l),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),zt.fill(0),s.slice(0,r)}var jr=Object.defineProperty,Si=(e,t,n)=>t in e?jr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,z=(e,t)=>{for(var n in t)jr(e,n,{get:t[n],enumerable:!0})},_t=(e,t,n)=>(Si(e,typeof t!="symbol"?t+"":t,n),n),ze=Symbol("verified"),Bi=e=>e instanceof Object;function Kr(e){if(!Bi(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var Ti={};z(Ti,{Queue:()=>ki,QueueNode:()=>Wr,binarySearch:()=>bn,insertEventIntoAscendingList:()=>Li,insertEventIntoDescendingList:()=>Ii,normalizeURL:()=>$i,utf8Decoder:()=>he,utf8Encoder:()=>fe});var he=new TextDecoder("utf-8"),fe=new TextEncoder;function $i(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function Ii(e,t){const[n,r]=bn(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function Li(e,t){const[n,r]=bn(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function bn(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var Wr=class{constructor(t){$(this,"value");$(this,"next",null);$(this,"prev",null);this.value=t}},ki=class{constructor(){$(this,"first");$(this,"last");this.first=null,this.last=null}enqueue(t){const n=new Wr(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,t.value}},Ui=class{generateSecretKey(){return ce.utils.randomPrivateKey()}getPublicKey(t){return j(ce.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=j(ce.getPublicKey(n)),r.id=lt(r),r.sig=j(ce.sign(lt(r),n)),r[ze]=!0,r}verifyEvent(t){if(typeof t[ze]=="boolean")return t[ze];const n=lt(t);if(n!==t.id)return t[ze]=!1,!1;try{const r=ce.verify(t.sig,n,t.pubkey);return t[ze]=r,r}catch{return t[ze]=!1,!1}}};function Ri(e){if(!Kr(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function lt(e){let t=je(fe.encode(Ri(e)));return j(t)}var St=new Ui;St.generateSecretKey;St.getPublicKey;var Le=St.finalizeEvent,vn=St.verifyEvent,Ci={};z(Ci,{Application:()=>Ca,BadgeAward:()=>Vi,BadgeDefinition:()=>Ta,BlockedRelaysList:()=>da,BookmarkList:()=>la,Bookmarksets:()=>_a,Calendar:()=>Da,CalendarEventRSVP:()=>za,ChannelCreation:()=>Yr,ChannelHideMessage:()=>eo,ChannelMessage:()=>Qr,ChannelMetadata:()=>Xr,ChannelMuteUser:()=>to,ClassifiedListing:()=>Ha,ClientAuth:()=>no,CommunitiesList:()=>ua,CommunityDefinition:()=>Ka,CommunityPostApproval:()=>Xi,Contacts:()=>Mi,CreateOrUpdateProduct:()=>La,CreateOrUpdateStall:()=>Ia,Curationsets:()=>Sa,Date:()=>Ma,DraftClassifiedListing:()=>Pa,DraftLong:()=>Ua,Emojisets:()=>Ra,EncryptedDirectMessage:()=>qi,EncryptedDirectMessages:()=>Di,EventDeletion:()=>zi,FileMetadata:()=>Wi,FileServerPreference:()=>ya,Followsets:()=>ma,GenericRepost:()=>ji,Genericlists:()=>xa,HTTPAuth:()=>xn,Handlerinformation:()=>ja,Handlerrecommendation:()=>Va,Highlights:()=>sa,InterestsList:()=>pa,Interestsets:()=>$a,JobFeedback:()=>ta,JobRequest:()=>Qi,JobResult:()=>ea,Label:()=>Yi,LightningPubRPC:()=>ba,LiveChatMessage:()=>Zi,LiveEvent:()=>Oa,LongFormArticle:()=>ka,Metadata:()=>Ni,Mutelist:()=>ia,NWCWalletInfo:()=>wa,NWCWalletRequest:()=>ro,NWCWalletResponse:()=>va,NostrConnect:()=>Ea,OpenTimestamps:()=>Ki,Pinlist:()=>aa,ProblemTracker:()=>Fi,ProfileBadges:()=>Ba,PublicChatsList:()=>fa,Reaction:()=>mn,RecommendRelay:()=>Pi,RelayList:()=>ca,Relaysets:()=>Aa,Report:()=>Gi,Reporting:()=>Ji,Repost:()=>En,SearchRelaysList:()=>ha,ShortTextNote:()=>Hi,Time:()=>qa,UserEmojiList:()=>ga,UserStatuses:()=>Na,Zap:()=>oa,ZapGoal:()=>na,ZapRequest:()=>ra,classifyKind:()=>Oi,isEphemeralKind:()=>Gr,isParameterizedReplaceableKind:()=>Jr,isRegularKind:()=>Zr,isReplaceableKind:()=>Fr});function Zr(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Fr(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Gr(e){return 2e4<=e&&e<3e4}function Jr(e){return 3e4<=e&&e<4e4}function Oi(e){return Zr(e)?"regular":Fr(e)?"replaceable":Gr(e)?"ephemeral":Jr(e)?"parameterized":"unknown"}var Ni=0,Hi=1,Pi=2,Mi=3,qi=4,Di=4,zi=5,En=6,mn=7,Vi=8,ji=16,Yr=40,Xr=41,Qr=42,eo=43,to=44,Ki=1040,Wi=1063,Zi=1311,Fi=1971,Gi=1984,Ji=1984,Yi=1985,Xi=4550,Qi=5999,ea=6999,ta=7e3,na=9041,ra=9734,oa=9735,sa=9802,ia=1e4,aa=10001,ca=10002,la=10003,ua=10004,fa=10005,da=10006,ha=10007,pa=10015,ga=10030,ya=10096,wa=13194,ba=21e3,no=22242,ro=23194,va=23195,Ea=24133,xn=27235,ma=3e4,xa=30001,Aa=30002,_a=30003,Sa=30004,Ba=30008,Ta=30009,$a=30015,Ia=30017,La=30018,ka=30023,Ua=30024,Ra=30030,Ca=30078,Oa=30311,Na=30315,Ha=30402,Pa=30403,Ma=31922,qa=31923,Da=31924,za=31925,Va=31989,ja=31990,Ka=34550,Wa={};z(Wa,{getHex64:()=>An,getInt:()=>oo,getSubscriptionId:()=>Za,matchEventId:()=>Fa,matchEventKind:()=>Ja,matchEventPubkey:()=>Ga});function An(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function oo(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Za(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function Fa(e,t){return t===An(e,"id")}function Ga(e,t){return t===An(e,"pubkey")}function Ja(e,t){return t===oo(e,"kind")}var Ya={};z(Ya,{makeAuthEvent:()=>Xa});function Xa(e,t){return{kind:no,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var Qa;try{Qa=WebSocket}catch{}var so={};z(so,{BECH32_REGEX:()=>io,Bech32MaxSize:()=>_n,decode:()=>Bt,encodeBytes:()=>Tt,naddrEncode:()=>ic,neventEncode:()=>sc,noteEncode:()=>rc,nprofileEncode:()=>oc,npubEncode:()=>nc,nrelayEncode:()=>ac,nsecEncode:()=>tc});var _n=5e3,io=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ec(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Bt(e){var o,s,i,a,c,l,f,u;let{prefix:t,words:n}=Ge.decode(e,_n),r=new Uint8Array(Ge.fromWords(n));switch(t){case"nprofile":{let d=ct(r);if(!((o=d[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(d[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:j(d[0][0]),relays:d[1]?d[1].map(y=>he.decode(y)):[]}}}case"nevent":{let d=ct(r);if(!((s=d[0])!=null&&s[0]))throw new Error("missing TLV 0 for nevent");if(d[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(d[2]&&d[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(d[3]&&d[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:j(d[0][0]),relays:d[1]?d[1].map(y=>he.decode(y)):[],author:(i=d[2])!=null&&i[0]?j(d[2][0]):void 0,kind:(a=d[3])!=null&&a[0]?parseInt(j(d[3][0]),16):void 0}}}case"naddr":{let d=ct(r);if(!((c=d[0])!=null&&c[0]))throw new Error("missing TLV 0 for naddr");if(!((l=d[2])!=null&&l[0]))throw new Error("missing TLV 2 for naddr");if(d[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=d[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(d[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:he.decode(d[0][0]),pubkey:j(d[2][0]),kind:parseInt(j(d[3][0]),16),relays:d[1]?d[1].map(y=>he.decode(y)):[]}}}case"nrelay":{let d=ct(r);if(!((u=d[0])!=null&&u[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:he.decode(d[0][0])}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:j(r)};default:throw new Error(`unknown prefix ${t}`)}}function ct(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function tc(e){return Tt("nsec",e)}function nc(e){return Tt("npub",Fe(e))}function rc(e){return Tt("note",Fe(e))}function it(e,t){let n=Ge.toWords(t);return Ge.encode(e,n,_n)}function Tt(e,t){return it(e,t)}function oc(e){let t=$t({0:[Fe(e.pubkey)],1:(e.relays||[]).map(n=>fe.encode(n))});return it("nprofile",t)}function sc(e){let t;e.kind!==void 0&&(t=ec(e.kind));let n=$t({0:[Fe(e.id)],1:(e.relays||[]).map(r=>fe.encode(r)),2:e.author?[Fe(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return it("nevent",n)}function ic(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=$t({0:[fe.encode(e.identifier)],1:(e.relays||[]).map(r=>fe.encode(r)),2:[Fe(e.pubkey)],3:[new Uint8Array(t)]});return it("naddr",n)}function ac(e){let t=$t({0:[fe.encode(e)]});return it("nrelay",t)}function $t(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),yt(...t)}var cc={};z(cc,{decrypt:()=>lc,encrypt:()=>ao});async function ao(e,t,n){const r=e instanceof Uint8Array?j(e):e,o=Je.getSharedSecret(r,"02"+t),s=co(o);let i=Uint8Array.from(Lr(16)),a=fe.encode(n),c=Dr(s,i).encrypt(a),l=ge.encode(new Uint8Array(c)),f=ge.encode(new Uint8Array(i.buffer));return`${l}?iv=${f}`}async function lc(e,t,n){const r=e instanceof Uint8Array?j(e):e;let[o,s]=n.split("?iv="),i=Je.getSharedSecret(r,"02"+t),a=co(i),c=ge.decode(s),l=ge.decode(o),f=Dr(a,c).decrypt(l);return he.decode(f)}function co(e){return e.slice(1,33)}var uc={};z(uc,{NIP05_REGEX:()=>lo,isValid:()=>hc,queryProfile:()=>uo,searchDomain:()=>dc,useFetchImplementation:()=>fc});var lo=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,It;try{It=fetch}catch{}function fc(e){It=e}async function dc(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`;return(await(await It(n,{redirect:"error"})).json()).names}catch{return{}}}async function uo(e){var s;const t=e.match(lo);if(!t)return null;const[n,r="_",o]=t;try{const i=`https://${o}/.well-known/nostr.json?name=${r}`,a=await(await It(i,{redirect:"error"})).json();let c=a.names[r];return c?{pubkey:c,relays:(s=a.relays)==null?void 0:s[c]}:null}catch{return null}}async function hc(e,t){let n=await uo(t);return n?n.pubkey===e:!1}var pc={};z(pc,{parse:()=>gc});function gc(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)r[0]==="e"&&r[1]&&n.push(r),r[0]==="p"&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const o=n[r],[s,i,a,c]=o,l={id:i,relays:a?[a]:[]},f=r===0,u=r===n.length-1;if(c==="root"){t.root=l;continue}if(c==="reply"){t.reply=l;continue}if(c==="mention"){t.mentions.push(l);continue}if(f){t.root=l;continue}if(u){t.reply=l;continue}t.mentions.push(l)}return t}var yc={};z(yc,{fetchRelayInformation:()=>bc,useFetchImplementation:()=>wc});var fo;try{fo=fetch}catch{}function wc(e){fo=e}async function bc(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var vc={};z(vc,{getPow:()=>ho,minePow:()=>Ec});function ho(e){let t=0;for(let n=0;n<e.length;n++){const r=parseInt(e[n],16);if(r===0)t+=4;else{t+=Math.clz32(r)-28;break}}return t}function Ec(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=lt(r),ho(r.id)>=t)break}return r}var mc={};z(mc,{finishRepostEvent:()=>xc,getRepostedEvent:()=>Ac,getRepostedEventPointer:()=>po});function xc(e,t,n,r){return Le({kind:En,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:e.content===""?"":JSON.stringify(t),created_at:e.created_at},r)}function po(e){if(e.kind!==En)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function Ac(e,{skipVerification:t}={}){const n=po(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!vn(r)))return r}var _c={};z(_c,{NOSTR_URI_REGEX:()=>Lt,parse:()=>Bc,test:()=>Sc});var Lt=new RegExp(`nostr:(${io.source})`);function Sc(e){return typeof e=="string"&&new RegExp(`^${Lt.source}$`).test(e)}function Bc(e){const t=e.match(new RegExp(`^${Lt.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Bt(t[1])}}var Tc={};z(Tc,{finishReactionEvent:()=>$c,getReactedEventPointer:()=>Ic});function $c(e,t,n){const r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return Le({...e,kind:mn,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Ic(e){if(e.kind!==mn)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Lc={};z(Lc,{matchAll:()=>kc,regex:()=>Sn,replaceAll:()=>Uc});var Sn=()=>new RegExp(`\\b${Lt.source}\\b`,"g");function*kc(e){const t=e.matchAll(Sn());for(const n of t)try{const[r,o]=n;yield{uri:r,value:o,decoded:Bt(o),start:n.index,end:n.index+r.length}}catch{}}function Uc(e,t){return e.replaceAll(Sn(),(n,r)=>t({uri:n,value:r,decoded:Bt(r)}))}var Rc={};z(Rc,{channelCreateEvent:()=>Cc,channelHideMessageEvent:()=>Hc,channelMessageEvent:()=>Nc,channelMetadataEvent:()=>Oc,channelMuteUserEvent:()=>Pc});var Cc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Le({kind:Yr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Oc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Le({kind:Xr,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Nc=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Le({kind:Qr,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Hc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Le({kind:eo,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Pc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return Le({kind:to,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Mc={};z(Mc,{EMOJI_SHORTCODE_REGEX:()=>go,matchAll:()=>qc,regex:()=>Bn,replaceAll:()=>Dc});var go=/:(\w+):/,Bn=()=>new RegExp(`\\B${go.source}\\B`,"g");function*qc(e){const t=e.matchAll(Bn());for(const n of t)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Dc(e,t){return e.replaceAll(Bn(),(n,r)=>t({shortcode:n,name:r}))}var zc={};z(zc,{useFetchImplementation:()=>Vc,validateGithub:()=>jc});var Tn;try{Tn=fetch}catch{}function Vc(e){Tn=e}async function jc(e,t,n){try{return await(await Tn(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var Kc={};z(Kc,{default:()=>Zc,v2:()=>$n});var Wc=new TextDecoder,ae=class{static utf8Decode(e){return Wc.decode(e)}static getConversationKey(e,t){const n=Je.getSharedSecret(e,"02"+t).subarray(1,33);return Ai(je,n,"nip44-v2")}static getMessageKeys(e,t){const n=_i(je,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}static calcPaddedLen(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}static writeU16BE(e){if(!Number.isSafeInteger(e)||e<ae.minPlaintextSize||e>ae.maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}static pad(e){const t=ae.utf8Encode(e),n=t.length,r=ae.writeU16BE(n),o=new Uint8Array(ae.calcPaddedLen(n)-n);return yt(r,t,o)}static unpad(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<ae.minPlaintextSize||t>ae.maxPlaintextSize||n.length!==t||e.length!==2+ae.calcPaddedLen(t))throw new Error("invalid padding");return ae.utf8Decode(n)}static hmacAad(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=yt(n,t);return At(je,e,r)}static decodePayload(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=ge.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}},oe=ae;_t(oe,"minPlaintextSize",1);_t(oe,"maxPlaintextSize",65535);_t(oe,"utf8Encode",Tr);var $n=class{static encrypt(e,t,n=Lr(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:s}=oe.getMessageKeys(t,n),i=oe.pad(e),a=Xn(r,o,i),c=oe.hmacAad(s,a,n);return ge.encode(yt(new Uint8Array([2]),n,a,c))}static decrypt(e,t){const{nonce:n,ciphertext:r,mac:o}=oe.decodePayload(e),{chacha_key:s,chacha_nonce:i,hmac_key:a}=oe.getMessageKeys(t,n),c=oe.hmacAad(a,r,n);if(!ri(c,o))throw new Error("invalid MAC");const l=Xn(s,i,r);return oe.unpad(l)}};_t($n,"utils",oe);var Zc={v2:$n},Fc={};z(Fc,{makeNwcRequestEvent:()=>Jc,parseConnectionString:()=>Gc});function Gc(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}async function Jc(e,t,n){const o=await ao(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:ro,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return Le(s,t)}var Yc={};z(Yc,{getZapEndpoint:()=>Qc,makeZapReceipt:()=>nl,makeZapRequest:()=>el,useFetchImplementation:()=>Xc,validateZapRequest:()=>tl});var In;try{In=fetch}catch{}function Xc(e){In=e}async function Qc(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:i}=Ge.decode(n,1e3),a=Ge.fromWords(i);t=he.decode(a)}else if(r){let[i,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else return null;let s=await(await In(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function el({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&s.tags.push(["e",t]),s}function tl(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Kr(t))return"Zap request is not a valid Nostr event.";if(!vn(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function nl({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&i.tags.push(["preimage",t]),i}var rl={};z(rl,{getToken:()=>ol,hashPayload:()=>Ln,unpackEventFromToken:()=>wo,validateEvent:()=>Ao,validateEventKind:()=>vo,validateEventMethodTag:()=>mo,validateEventPayloadTag:()=>xo,validateEventTimestamp:()=>bo,validateEventUrlTag:()=>Eo,validateToken:()=>sl});var yo="Nostr ";async function ol(e,t,n,r=!1,o){const s={kind:xn,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",Ln(o)]);const i=await n(s);return(r?yo:"")+ge.encode(fe.encode(JSON.stringify(i)))}async function sl(e,t,n){const r=await wo(e).catch(s=>{throw s});return await Ao(r,t,n).catch(s=>{throw s})}async function wo(e){if(!e)throw new Error("Missing token");e=e.replace(yo,"");const t=he.decode(ge.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function bo(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function vo(e){return e.kind===xn}function Eo(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function mo(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Ln(e){const t=je(fe.encode(JSON.stringify(e)));return j(t)}function xo(e,t){const n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=Ln(t);return n.length>0&&n[1]===r}async function Ao(e,t,n,r){if(!vn(e))throw new Error("Invalid nostr event, signature invalid");if(!vo(e))throw new Error("Invalid nostr event, kind invalid");if(!bo(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Eo(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!mo(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!xo(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const on=sn([]),er=sn(""),et=sn({});var Ue=Symbol("verified"),il=e=>e instanceof Object;function al(e){if(!il(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var cl=new TextEncoder;function tt(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var ll=class{constructor(e){$(this,"value");$(this,"next",null);$(this,"prev",null);this.value=e}},ul=class{constructor(){$(this,"first");$(this,"last");this.first=null,this.last=null}enqueue(e){const t=new ll(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},fl=class{generateSecretKey(){return ce.utils.randomPrivateKey()}getPublicKey(e){return j(ce.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=j(ce.getPublicKey(t)),n.id=Vt(n),n.sig=j(ce.sign(Vt(n),t)),n[Ue]=!0,n}verifyEvent(e){if(typeof e[Ue]=="boolean")return e[Ue];const t=Vt(e);if(t!==e.id)return e[Ue]=!1,!1;try{const n=ce.verify(e.sig,t,e.pubkey);return e[Ue]=n,n}catch{return e[Ue]=!1,!1}}};function dl(e){if(!al(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Vt(e){let t=je(cl.encode(dl(e)));return j(t)}var kt=new fl;kt.generateSecretKey;kt.getPublicKey;kt.finalizeEvent;var hl=kt.verifyEvent,pl=22242;function gl(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1&&!e.ids.some(n=>t.id.startsWith(n))||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1&&!e.authors.some(n=>t.pubkey.startsWith(n)))return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function yl(e,t){for(let n=0;n<e.length;n++)if(gl(e[n],t))return!0;return!1}function wl(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function bl(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function vl(e,t){return{kind:pl,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function El(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var ml=e=>(e[Ue]=!0,!0),_o;try{_o=WebSocket}catch{}var So=class{constructor(e,t){$(this,"url");$(this,"_connected",!1);$(this,"onclose",null);$(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));$(this,"_onauth",null);$(this,"baseEoseTimeout",4400);$(this,"connectionTimeout",4400);$(this,"openSubs",new Map);$(this,"connectionTimeoutHandle");$(this,"connectionPromise");$(this,"openCountRequests",new Map);$(this,"openEventPublishes",new Map);$(this,"ws");$(this,"incomingMessageQueue",new ul);$(this,"queueRunning",!1);$(this,"challenge");$(this,"serial",0);$(this,"verifyEvent");this.url=tt(e),this.verifyEvent=t.verifyEvent}static async connect(e,t){const n=new So(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new _o(this.url)}catch(n){t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{var r;t(n.message),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await El();this.queueRunning=!1}handleNext(){var n,r,o;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=bl(e);if(t){const s=this.openSubs.get(t);if(!s)return;const i=wl(e,"id"),a=(n=s.alreadyHaveEvent)==null?void 0:n.call(s,i);if((r=s.receivedEvent)==null||r.call(s,this,i),a)return}try{let s=JSON.parse(e);switch(s[0]){case"EVENT":{const i=this.openSubs.get(s[1]),a=s[2];this.verifyEvent(a)&&yl(i.filters,a)&&i.onevent(a);return}case"COUNT":{const i=s[1],a=s[2],c=this.openCountRequests.get(i);c&&(c.resolve(a.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(s[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=s[1],a=s[2],c=s[3],l=this.openEventPublishes.get(i);a?l.resolve(c):l.reject(new Error(c)),this.openEventPublishes.delete(i);return}case"CLOSED":{const i=s[1],a=this.openSubs.get(i);if(!a)return;a.closed=!0,a.close(s[2]);return}case"NOTICE":this.onnotice(s[1]);return;case"AUTH":{this.challenge=s[1],(o=this._onauth)==null||o.call(this,s[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(vl(this.url,this.challenge)),n=new Promise((r,o)=>{this.openEventPublishes.set(t.id,{resolve:r,reject:o})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise((n,r)=>{this.openEventPublishes.set(e.id,{resolve:n,reject:r})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new xl(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},xl=class{constructor(e,t,n,r){$(this,"relay");$(this,"id");$(this,"closed",!1);$(this,"eosed",!1);$(this,"filters");$(this,"alreadyHaveEvent");$(this,"receivedEvent");$(this,"onevent");$(this,"oneose");$(this,"onclose");$(this,"eoseTimeout");$(this,"eoseTimeoutHandle");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},Al=class{constructor(e){$(this,"relays",new Map);$(this,"seenOn",new Map);$(this,"trackRelays",!1);$(this,"verifyEvent");$(this,"trustedRelayURLs",new Set);this.verifyEvent=e.verifyEvent}async ensureRelay(e,t){e=tt(e);let n=this.relays.get(e);return n||(n=new So(e,{verifyEvent:this.trustedRelayURLs.has(e)?ml:this.verifyEvent}),t!=null&&t.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(tt).forEach(t=>{var n;(n=this.relays.get(t))==null||n.close()})}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map(r=>[r,t])),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(u,d)=>{let y=this.seenOn.get(d);y||(y=new Set,this.seenOn.set(d,y)),y.add(u)});const n=new Set,r=[],o=Object.keys(e).length,s=[];let i=u=>{var d;s[u]=!0,s.filter(y=>y).length===o&&((d=t.oneose)==null||d.call(t),i=()=>{})};const a=[];let c=(u,d)=>{var y;i(u),a[u]=d,a.filter(b=>b).length===o&&((y=t.onclose)==null||y.call(t,a),c=()=>{})};const l=u=>{var y;if((y=t.alreadyHaveEvent)!=null&&y.call(t,u))return!0;const d=n.has(u);return n.add(u),d},f=Promise.all(Object.entries(e).map(async(u,d,y)=>{if(y.indexOf(u)!==d){c(d,"duplicate url");return}let[b,h]=u;b=tt(b);let p;try{p=await this.ensureRelay(b,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(w){c(d,(w==null?void 0:w.message)||String(w));return}let g=p.subscribe(h,{...t,oneose:()=>i(d),onclose:w=>c(d,w),alreadyHaveEvent:l,eoseTimeout:t.maxWait});r.push(g)}));return{async close(){await f,r.forEach(u=>{u.close()})}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise(async r=>{const o=[];this.subscribeManyEose(e,[t],{...n,onevent(s){o.push(s)},onclose(s){r(o)}})})}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null}publish(e,t){return e.map(tt).map(async(n,r,o)=>o.indexOf(n)!==r?Promise.reject("duplicate url"):(await this.ensureRelay(n)).publish(t))}},Bo=class extends Al{constructor(){super({verifyEvent:hl})}};function tr(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r[11]=t,r[12]=n,r}function _l(e){let t,n,r,o;return{c(){t=ee("img"),this.h()},l(s){t=te(s,"IMG",{src:!0,class:!0}),this.h()},h(){Cn(t.src,n=e[1].picture)||G(t,"src",n),G(t,"class","svelte-u7s3ss")},m(s,i){Y(s,t,i),r||(o=Ke(t,"click",e[4]),r=!0)},p(s,i){i&2&&!Cn(t.src,n=s[1].picture)&&G(t,"src",n)},d(s){s&&V(t),r=!1,o()}}}function Sl(e){let t,n,r,o="Save",s,i;return{c(){t=ee("input"),n=Oe(),r=ee("button"),r.textContent=o,this.h()},l(a){t=te(a,"INPUT",{type:!0,class:!0}),n=Ne(a),r=te(a,"BUTTON",{class:!0,"data-svelte-h":!0}),ut(r)!=="svelte-75z6l9"&&(r.textContent=o),this.h()},h(){G(t,"type","text"),G(t,"class","svelte-u7s3ss"),G(r,"class","svelte-u7s3ss")},m(a,c){Y(a,t,c),ft(t,e[1].picture),Y(a,n,c),Y(a,r,c),s||(i=[Ke(t,"input",e[5]),Ke(r,"click",e[6])],s=!0)},p(a,c){c&2&&t.value!==a[1].picture&&ft(t,a[1].picture)},d(a){a&&(V(t),V(n),V(r)),s=!1,sr(i)}}}function nr(e){let t,n,r=e[9]+"",o,s,i,a,c,l;function f(){e[7].call(i,e[9])}return{c(){t=ee("div"),n=ee("p"),o=Ro(r),s=Oe(),i=ee("input"),a=Oe(),this.h()},l(u){t=te(u,"DIV",{class:!0});var d=nt(t);n=te(d,"P",{class:!0});var y=nt(n);o=Co(y,r),y.forEach(V),s=Ne(d),i=te(d,"INPUT",{type:!0,class:!0}),a=Ne(d),d.forEach(V),this.h()},h(){G(n,"class","svelte-u7s3ss"),G(i,"type","text"),G(i,"class","svelte-u7s3ss"),G(t,"class","card svelte-u7s3ss")},m(u,d){Y(u,t,d),Se(t,n),Se(n,o),Se(t,s),Se(t,i),ft(i,e[1][e[9]]),Se(t,a),c||(l=Ke(i,"input",f),c=!0)},p(u,d){e=u,d&2&&r!==(r=e[9]+"")&&Oo(o,r),d&2&&i.value!==e[1][e[9]]&&ft(i,e[1][e[9]])},d(u){u&&V(t),c=!1,l()}}}function rr(e){let t,n=e[9]!="pubkey"&&e[9]!="npub"&&e[9]!="picture"&&e[9]!="created_at"&&nr(e);return{c(){n&&n.c(),t=On()},l(r){n&&n.l(r),t=On()},m(r,o){n&&n.m(r,o),Y(r,t,o)},p(r,o){r[9]!="pubkey"&&r[9]!="npub"&&r[9]!="picture"&&r[9]!="created_at"?n?n.p(r,o):(n=nr(r),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(r){r&&V(t),n&&n.d(r)}}}function Bl(e){let t,n,r,o,s,i,a="Add field",c,l,f="Save",u,d;function y(w,x){return w[0]?Sl:_l}let b=y(e),h=b(e),p=Nn(Object.entries(e[1])),g=[];for(let w=0;w<p.length;w+=1)g[w]=rr(tr(e,p,w));return{c(){t=ee("div"),h.c(),n=Oe(),r=ee("div");for(let w=0;w<g.length;w+=1)g[w].c();o=Oe(),s=ee("div"),i=ee("button"),i.textContent=a,c=Oe(),l=ee("button"),l.textContent=f,this.h()},l(w){t=te(w,"DIV",{class:!0});var x=nt(t);h.l(x),x.forEach(V),n=Ne(w),r=te(w,"DIV",{class:!0});var A=nt(r);for(let m=0;m<g.length;m+=1)g[m].l(A);A.forEach(V),o=Ne(w),s=te(w,"DIV",{class:!0});var T=nt(s);i=te(T,"BUTTON",{class:!0,"data-svelte-h":!0}),ut(i)!=="svelte-mls9kw"&&(i.textContent=a),c=Ne(T),l=te(T,"BUTTON",{class:!0,"data-svelte-h":!0}),ut(l)!=="svelte-13jabvw"&&(l.textContent=f),T.forEach(V),this.h()},h(){G(t,"class","pic svelte-u7s3ss"),G(r,"class","grid svelte-u7s3ss"),G(i,"class","svelte-u7s3ss"),G(l,"class","svelte-u7s3ss"),G(s,"class","buttons svelte-u7s3ss")},m(w,x){Y(w,t,x),h.m(t,null),Y(w,n,x),Y(w,r,x);for(let A=0;A<g.length;A+=1)g[A]&&g[A].m(r,null);Y(w,o,x),Y(w,s,x),Se(s,i),Se(s,c),Se(s,l),u||(d=[Ke(i,"click",e[3]),Ke(l,"click",e[2])],u=!0)},p(w,[x]){if(b===(b=y(w))&&h?h.p(w,x):(h.d(1),h=b(w),h&&(h.c(),h.m(t,null))),x&2){p=Nn(Object.entries(w[1]));let A;for(A=0;A<p.length;A+=1){const T=tr(w,p,A);g[A]?g[A].p(T,x):(g[A]=rr(T),g[A].c(),g[A].m(r,null))}for(;A<g.length;A+=1)g[A].d(1);g.length=p.length}},i:jt,o:jt,d(w){w&&(V(t),V(n),V(r),V(o),V(s)),h.d(),Uo(g,w),u=!1,sr(d)}}}function Tl(e,t,n){let r;Io(e,et,d=>n(1,r=d));const o=new Bo;let s=!1;async function i(){for(let y in r)r[y]==""&&delete r[y];const d=await window.nostr.signEvent({kind:0,content:JSON.stringify(r),created_at:Math.ceil(Date.now()/1e3),tags:[]});o.publish(Kt(on),d)}function a(){const d=prompt("Field name");d&&(r[d]&&!confirm(`Field ${d} already exists. Overwrite?`)||Lo(et,r[d]="",r))}function c(){n(0,s=!0)}function l(){r.picture=this.value,et.set(r)}const f=()=>n(0,s=!1);function u(d){r[d]=this.value,et.set(r)}return[s,r,i,a,c,l,f,u]}class $l extends ir{constructor(t){super(),ar(this,t,Tl,Bl,or,{})}}function Il(e){let t,n="Nostr Profile",r,o,s;return o=new $l({}),{c(){t=ee("header"),t.textContent=n,r=Oe(),No(o.$$.fragment)},l(i){t=te(i,"HEADER",{"data-svelte-h":!0}),ut(t)!=="svelte-hks0pt"&&(t.textContent=n),r=Ne(i),Ho(o.$$.fragment,i)},m(i,a){Y(i,t,a),Y(i,r,a),Po(o,i,a),s=!0},p:jt,i(i){s||(Mo(o.$$.fragment,i),s=!0)},o(i){qo(o.$$.fragment,i),s=!1},d(i){i&&(V(t),V(r)),Do(o,i)}}}function Ll(e){const t=new Bo;function n(s){return!s.startsWith("npub")&&!s.startsWith("nprofile")&&(s=so.npubEncode(s)),s}async function r(s){return console.log(s),(await t.querySync(Kt(on),{authors:[s],kinds:[0]})).flatMap(a=>{const c=JSON.parse(a.content);return c.npub||(c.npub=n(a.pubkey)),c.pubkey||(c.pubkey=a.pubkey),[c]})[0]}async function o(){on.set(["wss://relay.snort.social/"]),er.set(await window.nostr.getPublicKey()),et.set(await r(Kt(er)))}return ko(()=>{o()}),[]}class Vl extends ir{constructor(t){super(),ar(this,t,Ll,Il,or,{})}}export{Vl as component};
